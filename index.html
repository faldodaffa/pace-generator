<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PACE - Prompt Assistant & Creative Engine v5.9 (Mobile Optimized)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap');
        
        /* SE2026 Brand Identity Colors */
        :root {
            --se-orange: #f79039;       
            --se-yellow-asa: #febd26;   
            --se-light-bg: #fffbee;     
            --se-dark: #231f20;         
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
            color: var(--se-dark);
            padding-bottom: 120px; /* Space for floating button */
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* UI Cards - Modern & Soft */
        .input-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 1rem;
        }
        
        .input-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(247, 144, 57, 0.1), 0 10px 10px -5px rgba(247, 144, 57, 0.04);
            border-color: #fdba74;
        }

        .select-custom {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23231f20' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 1rem center;
            background-repeat: no-repeat;
            background-size: 1.2em 1.2em;
            appearance: none;
        }

        /* Option Cards Styling */
        .option-card {
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            background-color: #f8fafc;
            position: relative;
            overflow: hidden;
        }
        .option-card:hover {
            border-color: var(--se-yellow-asa);
            background-color: #fffdf5;
            transform: scale(1.02);
        }
        .option-card.selected {
            border-color: var(--se-orange);
            background-color: #fff7ed;
            box-shadow: 0 4px 6px -1px rgba(247, 144, 57, 0.15);
        }
        .option-card.selected::after {
            content: '\f058';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 4px;
            right: 4px;
            color: var(--se-orange);
            font-size: 1rem;
            background: white;
            border-radius: 50%;
            line-height: 1;
        }
        
        /* Grids */
        .pose-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; }
        .expression-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; }

        /* Modern Button Styles */
        .btn-generate {
            background: linear-gradient(135deg, #f79039 0%, #ea580c 100%);
            color: white;
            border: none;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1;
        }
        .btn-generate::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #231f20 0%, #0f172a 100%);
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
        }
        .btn-generate:hover::before {
            opacity: 1;
        }
        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px -5px rgba(247, 144, 57, 0.4);
        }
        .btn-generate:active {
            transform: translateY(1px);
        }

        .gender-btn { transition: all 0.2s ease; }
        .gender-btn:hover { background-color: #fff7ed; border-color: #fdba74; }
        .gender-btn.selected {
            background-color: var(--se-orange);
            color: white;
            border-color: var(--se-orange);
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(247, 144, 57, 0.3);
        }

        /* Syntax Highlighting */
        .json-key { color: #f0a0a0; font-weight: bold; }
        .json-string { color: #a5d6ff; }
        .json-number { color: #d2a8ff; }
        .json-boolean { color: #ff7b72; font-weight: bold; }
        
        /* Badges for Changelog */
        .badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; margin-right: 6px; }
        .badge-fix { background-color: #fee2e2; color: #b91c1c; }
        .badge-ui { background-color: #e0e7ff; color: #4338ca; }
        .badge-docs { background-color: #d1fae5; color: #047857; }
        .badge-new { background-color: #fef3c7; color: #b45309; }
        .badge-logic { background-color: #f3e8ff; color: #7e22ce; }
        .badge-safety { background-color: #ffedd5; color: #c2410c; }

        /* Responsive Fixes */
        @media (max-width: 640px) {
            .pose-grid, .expression-grid { grid-template-columns: repeat(3, 1fr); }
            body { padding-bottom: 140px; }
            /* Memastikan tombol di header tidak terlalu besar di HP */
            header button, header a { 
                padding: 0.5rem 0.75rem !important;
                font-size: 0.7rem !important;
            }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-[#231f20] text-white shadow-xl border-b-[3px] border-[#f79039] sticky top-0 z-50 backdrop-blur-md bg-opacity-95">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-gradient-to-br from-[#f79039] to-[#ea580c] text-white p-2 rounded-xl font-extrabold text-lg h-11 w-11 flex items-center justify-center shadow-lg transform rotate-3 border border-white/20">
                    SE
                </div>
                <div>
                    <!-- UPDATED: Version 5.9 and Full Name -->
                    <h1 class="text-lg md:text-xl font-extrabold tracking-tight leading-none">PACE <span class="text-[#f79039]">v5.9</span></h1>
                    <p class="text-gray-400 text-[10px] md:text-xs font-medium tracking-wide">Prompt Assistant & Creative Engine</p>
                </div>
            </div>
            <!-- Header Buttons -->
            <div class="flex items-center gap-2 md:gap-3 text-right text-xs">
                <button onclick="toggleAssetModal()" class="inline-flex items-center bg-gray-800 border border-gray-600 hover:border-[#febd26] text-gray-300 hover:text-[#febd26] font-semibold py-2 px-3 md:px-4 rounded-lg transition-all duration-300 group">
                    <i class="fas fa-folder-open md:mr-2 text-sm group-hover:animate-bounce"></i>
                    <span class="ml-1 md:inline">Aset</span> 
                </button>
                <a href="#tutorial" class="inline-flex items-center bg-[#f79039] hover:bg-[#ea580c] text-white font-bold py-2 px-3 md:px-4 rounded-lg transition-colors shadow-lg hover:shadow-orange-500/50">
                    <i class="fas fa-info-circle md:mr-2 text-sm"></i>
                    <span class="hidden md:inline">Petunjuk</span>
                </a>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-12 gap-8 flex-grow w-full">
        
        <!-- LEFT COLUMN: Identity & Style (4 cols) -->
        <div class="lg:col-span-4 space-y-6">
            
            <!-- Disclaimer Box - STRATEGIC PLACEMENT -->
            <div class="bg-amber-50 border-l-4 border-amber-500 p-4 rounded-xl shadow-sm animate-fade-in-down">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <i class="fas fa-lightbulb text-amber-500 text-xl mt-1"></i>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-bold text-amber-800">Tips Pro:</h3>
                        <div class="text-xs text-amber-700 mt-1 leading-relaxed">
                            <p>Akurasi wajah sangat bergantung pada <strong>"Upload Gambar"</strong>. Jangan hanya copy-paste teks prompt.</p> 
                            <p class="mt-1">Gunakan tombol <span class="font-bold bg-white px-1 rounded border border-amber-200">+</span> di Gemini untuk upload file referensi.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 1. Format Gambar -->
            <div class="p-6 rounded-2xl shadow-sm input-card">
                <label class="flex items-center text-sm font-bold text-[#231f20] mb-4">
                    <div class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center mr-3 text-[#f79039]">
                        <i class="fas fa-image"></i>
                    </div>
                    1. Format Gambar
                </label>
                <div class="grid grid-cols-2 gap-4">
                    <div onclick="selectFormat('single')" id="fmt-single" class="option-card selected p-4 rounded-xl text-center">
                        <i class="fas fa-portrait text-3xl text-[#f79039] mb-3 transition-transform duration-300"></i>
                        <div class="text-sm font-bold">Single Image</div>
                        <div class="text-[10px] text-gray-500 mt-1">Satu Pose Fokus</div>
                    </div>
                    <div onclick="selectFormat('multipose')" id="fmt-multipose" class="option-card p-4 rounded-xl text-center">
                        <i class="fas fa-users-viewfinder text-3xl text-[#febd26] mb-3 transition-transform duration-300"></i>
                        <div class="text-sm font-bold">Multipose (2x2)</div>
                        <div class="text-[10px] text-gray-500 mt-1">Character Sheet</div>
                    </div>
                </div>
                <input type="hidden" id="formatValue" value="single">
            </div>

            <!-- 2. Gender & Skin Tone -->
            <div class="p-6 rounded-2xl shadow-sm input-card">
                <label class="flex items-center text-sm font-bold text-[#231f20] mb-4">
                    <div class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center mr-3 text-[#f79039]">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    2. Identitas Karakter
                </label>
                
                <div class="mb-5">
                    <span class="text-xs font-semibold text-gray-500 uppercase tracking-wide block mb-2">Gender</span>
                    <div class="flex gap-3">
                        <button type="button" onclick="selectGender('male')" id="btn-male" class="gender-btn selected flex-1 py-2.5 rounded-xl border border-gray-200 bg-white text-gray-600 text-xs flex flex-col items-center gap-1">
                            <i class="fas fa-mars text-sm"></i> Pria
                        </button>
                        <button type="button" onclick="selectGender('female_nonhijab')" id="btn-female_nonhijab" class="gender-btn flex-1 py-2.5 rounded-xl border border-gray-200 bg-white text-gray-600 text-xs flex flex-col items-center gap-1">
                            <i class="fas fa-venus text-sm"></i> Wanita
                        </button>
                        <button type="button" onclick="selectGender('female_hijab')" id="btn-female_hijab" class="gender-btn flex-1 py-2.5 rounded-xl border border-gray-200 bg-white text-gray-600 text-xs flex flex-col items-center gap-1">
                            <i class="fas fa-user-astronaut text-sm"></i> Hijab
                        </button>
                    </div>
                    <input type="hidden" id="genderValue" value="male">
                </div>

                <div>
                    <span class="text-xs font-semibold text-gray-500 uppercase tracking-wide block mb-2">Warna Kulit</span>
                    <div class="relative">
                        <select id="skinToneSelect" class="select-custom w-full bg-gray-50 hover:bg-white border border-gray-300 text-[#231f20] text-sm rounded-xl block p-3.5 focus:border-[#f79039] focus:ring-2 focus:ring-[#f79039] focus:ring-opacity-20 transition-all cursor-pointer font-medium">
                            <option value="fair">Kuning Langsat (Fair)</option>
                            <option value="tan">Sawo Matang (Tan)</option>
                            <option value="dark">Coklat Eksotis (Warm Umber)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 3. Accessories (Wearables) -->
            <div class="p-6 rounded-2xl shadow-sm input-card">
                <label class="flex items-center text-sm font-bold text-[#231f20] mb-4">
                    <div class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center mr-3 text-[#f79039]">
                        <i class="fas fa-hat-cowboy"></i>
                    </div>
                    3. Aksesoris & Atribut
                </label>

                <!-- Headgear -->
                <div class="mb-5 space-y-2">
                    <span class="text-xs font-semibold text-gray-500 uppercase tracking-wide block mb-2">Topi / Kepala</span>
                    <label class="flex items-center space-x-3 cursor-pointer hover:bg-orange-50 p-2.5 rounded-lg border border-transparent hover:border-orange-200 transition-colors group">
                        <input type="radio" name="headgear" value="none" class="text-[#f79039] focus:ring-[#f79039]" checked onclick="toggleCustomInput('headgear', false)">
                        <span class="text-xs font-medium text-gray-700 group-hover:text-[#231f20]">Tanpa Topi Khusus</span>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer hover:bg-orange-50 p-2.5 rounded-lg border border-transparent hover:border-orange-200 transition-colors group">
                        <input type="radio" name="headgear" value="topi_se2026" class="text-[#f79039] focus:ring-[#f79039]" onclick="toggleCustomInput('headgear', false)">
                        <span class="text-xs font-semibold text-[#231f20]">Topi SE2026</span>
                        <span class="text-[10px] text-red-500 bg-red-50 px-2 py-0.5 rounded-full ml-auto border border-red-100 font-bold">Wajib Upload</span>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer hover:bg-orange-50 p-2.5 rounded-lg border border-transparent hover:border-orange-200 transition-colors group">
                        <input type="radio" name="headgear" value="mahkota_papua" class="text-[#f79039] focus:ring-[#f79039]" onclick="toggleCustomInput('headgear', false)">
                        <span class="text-xs font-semibold text-[#231f20]">Mahkota Adat Papua</span>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer hover:bg-orange-50 p-2.5 rounded-lg border border-transparent hover:border-orange-200 transition-colors group">
                        <input type="radio" name="headgear" value="contextual" class="text-[#f79039] focus:ring-[#f79039]" onclick="toggleCustomInput('headgear', false)">
                        <span class="text-xs font-semibold text-blue-600">Sesuai Sektor (Helm/Caping)</span>
                    </label>
                    
                    <!-- Custom Headgear Input -->
                    <div class="pt-1 pl-1">
                        <label class="flex items-center space-x-3 cursor-pointer hover:bg-orange-50 p-2.5 rounded-lg border border-transparent hover:border-orange-200 transition-colors">
                            <input type="radio" name="headgear" value="custom_headgear" class="text-[#f79039] focus:ring-[#f79039]" onclick="toggleCustomInput('headgear', true)">
                            <span class="text-xs font-bold text-[#f79039]"><i class="fas fa-edit mr-1"></i> Custom Topi Adat</span>
                        </label>
                        <input type="text" id="customHeadgearText" placeholder="Contoh: Udeng Bali / Blangkon" class="hidden w-full mt-2 px-3 py-2.5 bg-gray-50 border border-gray-300 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-[#f79039] transition-all">
                    </div>
                </div>

                <div class="space-y-2 border-t border-dashed border-gray-200 pt-4">
                    <span class="text-xs font-semibold text-gray-500 uppercase tracking-wide block mb-2">Item Tubuh / Tangan</span>
                    <label class="flex items-center space-x-3 cursor-pointer hover:bg-orange-50 p-2.5 rounded-lg border border-transparent hover:border-orange-200">
                        <input type="checkbox" id="acc_noken" class="text-[#f79039] rounded focus:ring-[#f79039] w-4 h-4">
                        <span class="text-xs">Tas Noken Papua</span>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer hover:bg-orange-50 p-2.5 rounded-lg border border-transparent hover:border-orange-200">
                        <input type="checkbox" id="acc_hpse" class="text-[#f79039] rounded focus:ring-[#f79039] w-4 h-4">
                        <span class="text-xs font-bold text-[#231f20]">HP Logo SE2026</span>
                        <!-- AUDIT: Added Safety Badge for HP -->
                        <span class="text-[10px] text-red-500 bg-red-50 px-2 py-0.5 rounded-full ml-auto border border-red-100 font-bold">Wajib Upload</span>
                    </label>
                    <label class="flex items-center space-x-3 cursor-pointer hover:bg-orange-50 p-2.5 rounded-lg border border-transparent hover:border-orange-200">
                        <input type="checkbox" id="acc_glasses" class="text-[#f79039] rounded focus:ring-[#f79039] w-4 h-4">
                        <span class="text-xs">Kacamata</span>
                    </label>

                    <!-- Custom Accessory Input -->
                    <div class="pt-1 pl-1">
                        <label class="flex items-center space-x-3 cursor-pointer hover:bg-orange-50 p-2.5 rounded-lg border border-transparent hover:border-orange-200">
                            <input type="checkbox" id="acc_custom" class="text-[#f79039] rounded focus:ring-[#f79039] w-4 h-4" onchange="toggleCustomInput('accessory', this.checked)">
                            <span class="text-xs font-bold text-[#f79039]"><i class="fas fa-hand-holding mr-1"></i> Custom Pegang</span>
                        </label>
                        <input type="text" id="customAccessoryText" placeholder="Contoh: Tablet, Buku, Kain Ulos" class="hidden w-full mt-2 px-3 py-2.5 bg-gray-50 border border-gray-300 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-[#f79039] transition-all">
                    </div>
                </div>
            </div>

        </div>

        <!-- MIDDLE COLUMN: Context & Background (5 cols) -->
        <div class="lg:col-span-5 space-y-6">

             <!-- Expression Selection -->
             <div id="expressionSection" class="p-6 rounded-2xl shadow-sm input-card">
                <label class="flex items-center text-sm font-bold text-[#231f20] mb-4">
                    <div class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center mr-3 text-[#f79039]">
                        <i class="fas fa-face-smile"></i>
                    </div>
                    4. Ekspresi Wajah
                </label>
                
                <div class="expression-grid">
                    <div onclick="selectExpression('happy')" id="expr-happy" class="option-card selected p-2 rounded-xl text-center flex flex-col items-center justify-center h-24">
                        <i class="fas fa-face-laugh-beam text-3xl text-[#f79039] mb-2"></i>
                        <span class="text-[10px] leading-tight font-bold">Ceria</span>
                    </div>
                    <div onclick="selectExpression('laugh')" id="expr-laugh" class="option-card p-2 rounded-xl text-center flex flex-col items-center justify-center h-24">
                        <i class="fas fa-laugh-squint text-3xl text-orange-500 mb-2"></i>
                        <span class="text-[10px] leading-tight">Tertawa</span>
                    </div>
                    <div onclick="selectExpression('sad')" id="expr-sad" class="option-card p-2 rounded-xl text-center flex flex-col items-center justify-center h-24">
                        <i class="fas fa-face-sad-tear text-3xl text-blue-500 mb-2"></i>
                        <span class="text-[10px] leading-tight">Sedih</span>
                    </div>
                    <div onclick="selectExpression('shock')" id="expr-shock" class="option-card p-2 rounded-xl text-center flex flex-col items-center justify-center h-24">
                        <i class="fas fa-face-surprise text-3xl text-purple-600 mb-2"></i>
                        <span class="text-[10px] leading-tight">Kaget</span>
                    </div>
                    <div onclick="selectExpression('surprised')" id="expr-surprised" class="option-card p-2 rounded-xl text-center flex flex-col items-center justify-center h-24">
                        <i class="fas fa-face-grin-wide text-3xl text-teal-500 mb-2"></i>
                        <span class="text-[10px] leading-tight">Terkejut</span>
                    </div>
                    <div onclick="selectExpression('fear')" id="expr-fear" class="option-card p-2 rounded-xl text-center flex flex-col items-center justify-center h-24">
                        <i class="fas fa-face-flushed text-3xl text-indigo-600 mb-2"></i>
                        <span class="text-[10px] leading-tight">Takut</span>
                    </div>
                    <div onclick="selectExpression('shy')" id="expr-shy" class="option-card p-2 rounded-xl text-center flex flex-col items-center justify-center h-24">
                        <i class="fas fa-face-kiss-wink-heart text-3xl text-pink-500 mb-2"></i>
                        <span class="text-[10px] leading-tight">Malu</span>
                    </div>
                    <div onclick="selectExpression('thinking')" id="expr-thinking" class="option-card p-2 rounded-xl text-center flex flex-col items-center justify-center h-24">
                        <i class="fas fa-lightbulb text-3xl text-yellow-500 mb-2"></i>
                        <span class="text-[10px] leading-tight">Berpikir</span>
                    </div>
                </div>
                <input type="hidden" id="expressionValue" value="happy">
            </div>
            
            <!-- 5. Context (KBLI 2025) -->
            <div class="p-6 rounded-2xl shadow-lg border-l-8 border-[#febd26] bg-white relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-5">
                    <i class="fas fa-city text-9xl"></i>
                </div>
                
                <label class="flex items-center text-lg font-bold text-[#231f20] mb-2 z-10 relative">
                    <i class="fas fa-building mr-3 text-[#f79039] text-xl"></i> 5. Konteks Sektor
                </label>
                <p class="text-xs text-gray-500 mb-5 z-10 relative pl-8">Pilih kategori usaha sesuai KBLI 2025 untuk latar dan atribut otomatis.</p>
                
                <div class="relative z-10">
                    <select id="sectorSelect" class="select-custom w-full bg-yellow-50 hover:bg-white border border-yellow-200 text-[#231f20] text-sm rounded-xl focus:ring-[#f79039] focus:border-[#f79039] block p-4 mb-6 font-semibold shadow-sm transition-all cursor-pointer">
                        <option value="NONE" class="font-bold text-gray-400">-- Pilih Sektor (Opsional) --</option>
                        <optgroup label="Sektor Utama">
                            <option value="A">A. Pertanian, Kehutanan, dan Perikanan</option>
                            <option value="B">B. Pertambangan dan Penggalian</option>
                            <option value="C">C. Industri Pengolahan</option>
                            <option value="F">F. Konstruksi</option>
                            <option value="G">G. Perdagangan Besar & Eceran</option>
                        </optgroup>
                        <optgroup label="Sektor Jasa & Layanan">
                            <option value="D">D. Pengadaan Listrik, Gas, Uap</option>
                            <option value="E">E. Pengadaan Air & Limbah</option>
                            <option value="H">H. Pengangkutan & Pergudangan</option>
                            <option value="I">I. Penyediaan Akomodasi & Makan Minum</option>
                            <option value="J">J. Informasi & Komunikasi</option>
                            <option value="K">K. Aktivitas Keuangan & Asuransi</option>
                            <option value="L">L. Real Estat</option>
                            <option value="M">M. Aktivitas Profesional, Ilmiah & Teknis</option>
                            <option value="N">N. Aktivitas Penyewaan & Sewa Guna</option>
                        </optgroup>
                        <optgroup label="Sektor Publik & Lainnya">
                            <option value="O">O. Administrasi Pemerintahan</option>
                            <option value="P">P. Pendidikan</option>
                            <option value="Q">Q. Kesehatan & Sosial</option>
                            <option value="R">R. Kesenian & Hiburan</option>
                            <option value="S">S. Aktivitas Jasa Lainnya</option>
                            <option value="T">T. Aktivitas Rumah Tangga</option>
                            <option value="U">U. Aktivitas Badan Internasional</option>
                            <option value="STAKEHOLDER">-- KHUSUS: Stakeholder / Pejabat --</option>
                        </optgroup>
                    </select>

                    <!-- Baju Option -->
                    <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                        <span class="text-xs font-bold text-gray-500 uppercase tracking-wide block mb-3">Pakaian Utama</span>
                        <div class="flex flex-col gap-3">
                            <label class="flex items-center cursor-pointer group">
                                <div class="w-4 h-4 rounded-full border border-gray-300 flex items-center justify-center bg-white group-hover:border-[#f79039]">
                                    <input type="radio" name="attire" value="original" class="appearance-none w-2 h-2 rounded-full bg-transparent checked:bg-[#f79039]" checked onclick="toggleCustomInput('attire', false)">
                                </div>
                                <span class="ml-3 text-sm text-gray-700 font-medium group-hover:text-[#f79039] transition-colors">Seragam Asli (Rompi Sensus)</span>
                            </label>
                            <label class="flex items-center cursor-pointer group">
                                <div class="w-4 h-4 rounded-full border border-gray-300 flex items-center justify-center bg-white group-hover:border-[#f79039]">
                                    <input type="radio" name="attire" value="contextual" class="appearance-none w-2 h-2 rounded-full bg-transparent checked:bg-[#f79039]" onclick="toggleCustomInput('attire', false)">
                                </div>
                                <span class="ml-3 text-sm text-gray-700 font-medium group-hover:text-[#f79039] transition-colors">Sesuai Profesi KBLI (Dokter/Insinyur)</span>
                            </label>
                            
                            <!-- Custom Attire -->
                            <div class="pt-1">
                                <label class="flex items-center cursor-pointer group">
                                    <div class="w-4 h-4 rounded-full border border-gray-300 flex items-center justify-center bg-white group-hover:border-[#f79039]">
                                        <input type="radio" name="attire" value="custom_attire" class="appearance-none w-2 h-2 rounded-full bg-transparent checked:bg-[#f79039]" onclick="toggleCustomInput('attire', true)">
                                    </div>
                                    <span class="ml-3 text-sm font-bold text-[#f79039]"><i class="fas fa-edit mr-1"></i> Custom (Batik/Adat)</span>
                                </label>
                                <input type="text" id="customAttireText" placeholder="Contoh: Baju Batik Jawa / Baju Adat Bali" class="hidden w-full mt-2 px-3 py-2.5 bg-white border border-gray-300 rounded-lg text-xs focus:outline-none focus:ring-2 focus:ring-[#f79039] transition-all">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 6. Background Setting -->
            <div class="p-6 rounded-2xl shadow-sm input-card">
                <label class="flex items-center text-sm font-bold text-[#231f20] mb-4">
                    <div class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center mr-3 text-[#f79039]">
                        <i class="fas fa-image"></i>
                    </div>
                    6. Latar Belakang
                </label>
                
                <div class="grid grid-cols-2 gap-4">
                    <label class="cursor-pointer group">
                        <input type="radio" name="bg_mode" value="prop_focus" class="peer sr-only" checked onchange="updateBgDesc()">
                        <div class="rounded-xl border-2 border-gray-100 p-4 hover:bg-gray-50 peer-checked:border-[#f79039] peer-checked:bg-[#fff7ed] transition-all text-center h-full flex flex-col items-center justify-center group-hover:shadow-md">
                            <i class="fas fa-box-open text-3xl text-gray-400 peer-checked:text-[#f79039] mb-3 transition-colors"></i>
                            <h3 class="font-bold text-xs text-gray-700 peer-checked:text-[#231f20]">Fokus Barang/Alat</h3>
                        </div>
                    </label>

                    <label class="cursor-pointer group">
                        <input type="radio" name="bg_mode" value="environment" class="peer sr-only" onchange="updateBgDesc()">
                        <div class="rounded-xl border-2 border-gray-100 p-4 hover:bg-gray-50 peer-checked:border-[#f79039] peer-checked:bg-[#fff7ed] transition-all text-center h-full flex flex-col items-center justify-center group-hover:shadow-md">
                            <i class="fas fa-mountain-sun text-3xl text-gray-400 peer-checked:text-[#f79039] mb-3 transition-colors"></i>
                            <h3 class="font-bold text-xs text-gray-700 peer-checked:text-[#231f20]">Pemandangan Jauh</h3>
                        </div>
                    </label>
                </div>
            </div>

             <!-- 7. Pose Selection (Conditional) -->
             <div id="poseSection" class="p-6 rounded-2xl shadow-sm input-card">
                <label class="flex items-center text-sm font-bold text-[#231f20] mb-4">
                    <div class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center mr-3 text-[#f79039]">
                        <i class="fas fa-person-walking"></i>
                    </div>
                    7. Pilih Pose
                </label>
                
                <!-- 4x2 Grid for Poses -->
                <div class="pose-grid">
                    <!-- Row 1 -->
                    <div onclick="selectPose('random')" id="pose-random" class="option-card p-2 rounded-xl text-center flex flex-col items-center justify-center h-24 bg-yellow-50 border-yellow-200">
                        <i class="fas fa-dice text-2xl text-[#f79039] mb-2"></i>
                        <span class="text-[10px] leading-tight font-bold">Random</span>
                    </div>
                    <div onclick="selectPose('thumbs_up')" id="pose-thumbs_up" class="option-card selected p-2 rounded-xl text-center flex flex-col items-center justify-center h-24">
                        <i class="fas fa-thumbs-up text-2xl text-[#f79039] mb-2"></i>
                        <span class="text-[10px] leading-tight">Jempol</span>
                    </div>
                    <div onclick="selectPose('pointing')" id="pose-pointing" class="option-card p-2 rounded-xl text-center flex flex-col items-center justify-center h-24">
                        <i class="fas fa-hand-point-right text-2xl text-green-500 mb-2"></i>
                        <span class="text-[10px] leading-tight">Menunjuk</span>
                    </div>
                    <div onclick="selectPose('waving')" id="pose-waving" class="option-card p-2 rounded-xl text-center flex flex-col items-center justify-center h-24">
                        <i class="fas fa-hand-spock text-2xl text-orange-500 mb-2"></i>
                        <span class="text-[10px] leading-tight">Menyapa</span>
                    </div>
                    
                    <!-- Row 2 -->
                    <div onclick="selectPose('salute')" id="pose-salute" class="option-card p-2 rounded-xl text-center flex flex-col items-center justify-center h-24">
                        <i class="fas fa-user-shield text-2xl text-blue-500 mb-2"></i>
                        <span class="text-[10px] leading-tight">Hormat</span>
                    </div>
                    <div onclick="selectPose('hand_on_chest')" id="pose-hand_on_chest" class="option-card p-2 rounded-xl text-center flex flex-col items-center justify-center h-24">
                        <i class="fas fa-hand-holding-heart text-2xl text-red-500 mb-2"></i>
                        <span class="text-[10px] leading-tight">Pelayanan</span>
                    </div>
                    <div onclick="selectPose('thank_you')" id="pose-thank_you" class="option-card p-2 rounded-xl text-center flex flex-col items-center justify-center h-24">
                        <i class="fas fa-praying-hands text-2xl text-purple-500 mb-2"></i>
                        <span class="text-[10px] leading-tight">Terima Kasih</span>
                    </div>
                    <div onclick="selectPose('ready')" id="pose-ready" class="option-card p-2 rounded-xl text-center flex flex-col items-center justify-center h-24">
                         <i class="fas fa-user-check text-2xl text-teal-600 mb-2"></i>
                        <span class="text-[10px] leading-tight">Siap (Sigap)</span>
                    </div>
                </div>
                <input type="hidden" id="poseValue" value="thumbs_up">
            </div>

        </div>

        <!-- RIGHT COLUMN: Output (3 cols) -->
        <div class="lg:col-span-3 space-y-6">
            
            <!-- Output Display - AUDIT: Code Editor Look -->
            <div class="bg-[#0f172a] rounded-2xl shadow-2xl border border-gray-700 overflow-hidden flex flex-col h-[600px] sticky top-24 ring-4 ring-orange-500/10">
                <!-- Mac-like Window Header -->
                <div class="flex justify-between items-center px-4 py-3 bg-[#1e293b] border-b border-gray-700 shrink-0 select-none">
                    <div class="flex items-center gap-2">
                         <div class="w-3 h-3 rounded-full bg-[#ff5f56]"></div>
                         <div class="w-3 h-3 rounded-full bg-[#ffbd2e]"></div>
                         <div class="w-3 h-3 rounded-full bg-[#27c93f]"></div>
                         <span class="text-xs text-gray-400 font-mono ml-3 font-semibold tracking-wide">prompt_v5_8.json</span>
                    </div>
                    <button onclick="copyToClipboard()" class="text-[10px] bg-white/10 hover:bg-white/20 text-white font-bold px-3 py-1.5 rounded transition-all flex items-center group">
                        <span class="mr-2 group-hover:text-[#f79039] transition-colors">COPY</span> 
                        <i class="fas fa-copy group-hover:scale-110 transition-transform"></i>
                    </button>
                </div>
                
                <!-- Code Area with Line Numbers -->
                <div class="relative flex-grow bg-[#0f172a] overflow-hidden">
                    <div class="absolute left-0 top-0 bottom-0 w-10 bg-[#0f172a] border-r border-gray-800 flex flex-col items-end pt-5 pr-2 text-gray-600 text-xs font-mono leading-relaxed select-none">
                        <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span>
                    </div>
                    <div class="absolute inset-0 pl-12 pr-4 pt-5 pb-20 overflow-y-auto custom-scrollbar">
                         <pre id="jsonOutput" class="text-xs font-mono whitespace-pre-wrap leading-relaxed text-gray-300 font-['JetBrains_Mono']">/* Menunggu input... */</pre>
                    </div>
                    
                    <!-- Floating Generate Button in Desktop Context -->
                    <div class="absolute bottom-0 left-0 right-0 p-5 bg-gradient-to-t from-[#0f172a] via-[#0f172a] to-transparent">
                         <button onclick="generatePrompt()" class="btn-generate w-full font-bold py-4 px-6 rounded-xl shadow-2xl flex items-center justify-center gap-3 text-sm tracking-widest uppercase">
                            <i class="fas fa-wand-magic-sparkles text-lg animate-pulse"></i> Buat Prompt (JSON)
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Mobile Bottom Action Bar -->
    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white/90 backdrop-blur-md border-t border-gray-200 lg:hidden z-[60] shadow-[0_-5px_20px_rgba(0,0,0,0.1)]">
         <button onclick="generatePrompt()" class="btn-generate w-full font-extrabold py-3.5 px-6 rounded-xl shadow-xl flex items-center justify-center gap-2 text-lg tracking-wide">
            <i class="fas fa-wand-magic-sparkles animate-pulse"></i> BUAT PROMPT
        </button>
    </div>

    <!-- Tutorial Section - AUDIT: Updated Content -->
    <section id="tutorial" class="bg-white border-t border-gray-200 py-16 px-4 mt-10">
        <div class="max-w-5xl mx-auto">
            <div class="text-center mb-8">
                <span class="bg-orange-100 text-[#ea580c] font-bold px-3 py-1 rounded-full text-xs uppercase tracking-widest">Tutorial</span>
                <h2 class="text-3xl font-extrabold text-[#231f20] mt-3">Panduan Penggunaan</h2>
                <p class="text-gray-500 mt-2">Ikuti langkah spesifik ini agar maskot konsisten.</p>
            </div>
            
            <div class="flex flex-col md:flex-row justify-center gap-4 mb-12">
                <a href="https://s.bps.go.id/tutorialpromptbungitung" target="_blank" class="flex items-center justify-center gap-2 bg-red-600 text-white px-5 py-3 rounded-xl font-bold hover:bg-red-700 transition shadow-lg hover:shadow-red-500/30">
                    <i class="fab fa-youtube text-xl"></i> Tutorial Youtube
                </a>
                <a href="http://s.bps.go.id/contohhasilpacegenerator" target="_blank" class="flex items-center justify-center gap-2 bg-[#f79039] text-white px-5 py-3 rounded-xl font-bold hover:bg-[#ea580c] transition shadow-lg hover:shadow-orange-500/30">
                    <i class="fas fa-images text-xl"></i> Lihat Galeri Hasil
                </a>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <div class="space-y-6">
                    <h3 class="font-bold text-xl text-[#231f20] flex items-center"><span class="bg-[#231f20] text-white w-8 h-8 rounded-lg flex items-center justify-center mr-3 text-sm">1</span> Langkah Pembuatan</h3>
                    <ol class="space-y-4 text-sm text-gray-600 ml-3 border-l-2 border-gray-100 pl-6 relative">
                        <li class="relative before:absolute before:-left-[31px] before:top-1.5 before:w-3 before:h-3 before:bg-[#f79039] before:rounded-full">Pilih <strong>Format, Identitas,</strong> dan <strong>Kategori Sektor</strong>.</li>
                        <li class="relative before:absolute before:-left-[31px] before:top-1.5 before:w-3 before:h-3 before:bg-gray-300 before:rounded-full">Klik <strong>BUAT PROMPT (JSON)</strong> lalu klik tombol <strong>COPY</strong> di pojok kanan atas output.</li>
                        <li class="relative before:absolute before:-left-[31px] before:top-1.5 before:w-3 before:h-3 before:bg-gray-300 before:rounded-full">Buka <a href="https://gemini.google.com" target="_blank" class="text-blue-600 hover:underline font-bold">gemini.google.com</a>.</li>
                        <li class="relative before:absolute before:-left-[31px] before:top-1.5 before:w-3 before:h-3 before:bg-gray-300 before:rounded-full">Di tampilan percakapan baru, klik tombol <strong>"üçå Buat Gambar"</strong> atau <strong>"üçå Create Image"</strong>.</li>
                        <li class="relative before:absolute before:-left-[31px] before:top-1.5 before:w-3 before:h-3 before:bg-red-500 before:rounded-full font-bold text-gray-800">
                             PENTING: Klik tombol <strong>"+"</strong> lalu pilih <strong>"Upload File"</strong>, kemudian pilih:
                             <!-- AUDIT FIX: Hyperlinks added for direct download -->
                             <ul class="list-none ml-2 mt-2 font-normal text-gray-600 space-y-1">
                                 <li class="flex items-center">
                                     <i class="fas fa-download text-[#f79039] mr-2 text-xs"></i>
                                     <a href="https://drive.google.com/file/d/1LTIJKv5JVzy2mKmOk0lDocJ7uuBEtlVc/view?usp=drive_link" target="_blank" class="text-blue-600 underline decoration-dotted hover:text-blue-800 font-mono text-xs">bungitung.png</a> 
                                     <span class="text-xs ml-1 text-gray-500">(Wajib untuk wajah)</span>
                                </li>
                                 <li class="flex items-center">
                                     <i class="fas fa-download text-[#f79039] mr-2 text-xs"></i>
                                     <a href="https://drive.google.com/file/d/1-RDcopPf85uUsPK4OkczpbnH4fDGm28e/view?usp=drive_link" target="_blank" class="text-blue-600 underline decoration-dotted hover:text-blue-800 font-mono text-xs">topise2026.png</a>
                                     <span class="text-xs ml-1 text-gray-500">(Jika pakai Topi SE)</span>
                                </li>
                                 <li class="flex items-center">
                                     <i class="fas fa-download text-[#f79039] mr-2 text-xs"></i>
                                     <a href="https://drive.google.com/file/d/1RkeIIOjUCuea57enOZf6wrvdpDhAB2Eh/view?usp=drive_link" target="_blank" class="text-blue-600 underline decoration-dotted hover:text-blue-800 font-mono text-xs">hpse2026.png</a>
                                     <span class="text-xs ml-1 text-gray-500">(Jika pakai HP SE)</span>
                                </li>
                             </ul>
                             <div class="mt-2 text-xs font-normal text-amber-700 bg-amber-50 p-2 rounded border border-amber-200">
                                <i class="fas fa-info-circle mr-1"></i> Bisa menggunakan Gemini Free (Flash), namun hasil lebih akurat dengan versi Pro.
                             </div>
                        </li>
                        <li class="relative before:absolute before:-left-[31px] before:top-1.5 before:w-3 before:h-3 before:bg-gray-300 before:rounded-full">Paste kode JSON ke kolom chat, lalu tekan Enter.</li>
                    </ol>
                </div>
                <div class="space-y-6">
                    <h3 class="font-bold text-xl text-[#231f20] flex items-center"><span class="bg-[#febd26] text-[#231f20] w-8 h-8 rounded-lg flex items-center justify-center mr-3 text-sm">2</span> Catatan Teknis</h3>
                    <div class="bg-[#fffbee] p-5 rounded-2xl border border-yellow-100 shadow-sm">
                        <ul class="space-y-3 text-sm text-gray-700">
                            <li class="flex items-start"><i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i> <span><strong>Wajah Berubah?</strong> Upload <code>bungitung.png</code> adalah kunci. Tanpa upload, AI akan membuat wajah acak.</span></li>
                            <li class="flex items-start"><i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i> <span><strong>Kulit Coklat Eksotis:</strong> Setting <code>image_weight: MEDIUM</code> diset otomatis agar AI berani mengubah warna kulit Bung Itung (yang putih) menjadi gelap.</span></li>
                            <li class="flex items-start"><i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i> <span><strong>Nama File:</strong> Pastikan nama file aset yang diupload jelas (contoh: 'topi_se.png') agar AI paham konteksnya.</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Asset Modal -->
    <div id="assetModal" class="fixed inset-0 z-[70] hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity backdrop-blur-sm" aria-hidden="true" onclick="toggleAssetModal()"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full border border-gray-100">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-orange-100 sm:mx-0 sm:h-10 sm:w-10 mb-4 sm:mb-0">
                            <i class="fas fa-folder-open text-[#f79039]"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-xl leading-6 font-bold text-gray-900" id="modal-title">Aset Referensi</h3>
                            <p class="text-sm text-gray-500 mt-1">Download aset ini untuk diupload ke Gemini sebagai referensi.</p>
                            <div class="mt-5">
                                <div class="bg-gray-50 border border-gray-200 p-1 rounded-xl text-sm shadow-inner text-left max-h-[60vh] overflow-y-auto">
                                     <!-- ASSETS INJECTED VIA JS -->
                                    <div id="assetsContainer" class="p-3"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-4 sm:px-6 sm:flex sm:flex-row-reverse border-t border-gray-100">
                    <button type="button" class="w-full inline-flex justify-center rounded-xl border border-transparent shadow-sm px-5 py-2.5 bg-[#231f20] text-base font-medium text-white hover:bg-black focus:outline-none sm:ml-3 sm:w-auto sm:text-sm transition-all" onclick="toggleAssetModal()">
                        Tutup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- VERSION HISTORY MODAL (NEW) -->
    <div id="versionModal" class="fixed inset-0 z-[80] hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-900 bg-opacity-80 transition-opacity backdrop-blur-sm" aria-hidden="true" onclick="toggleVersionModal()"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full border border-gray-100 relative">
                <!-- Header Modal -->
                <div class="bg-[#231f20] px-4 py-4 sm:px-6 flex justify-between items-center">
                    <h3 class="text-lg leading-6 font-bold text-white flex items-center gap-2">
                        <i class="fas fa-code-branch text-[#f79039]"></i> PACE Generator - Version History
                    </h3>
                    <button onclick="toggleVersionModal()" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Content Modal -->
                <div class="px-4 py-5 sm:p-6 max-h-[70vh] overflow-y-auto custom-scrollbar bg-gray-50">
                    
                    <!-- v5.9 -->
                    <div class="mb-8 border-l-4 border-[#f79039] pl-4 relative">
                        <div class="absolute -left-[21px] top-0 w-3 h-3 rounded-full bg-[#f79039] ring-4 ring-white"></div>
                        <h4 class="font-bold text-lg text-[#231f20] flex items-center">v5.9 <span class="ml-2 text-[10px] bg-green-100 text-green-700 px-2 py-0.5 rounded-full border border-green-200">Current - Mobile Optimized</span></h4>
                        <p class="text-xs text-gray-500 mb-3 italic">Fokus pada aksesibilitas seluler dan efisiensi alur kerja.</p>
                        <ul class="space-y-2 text-xs text-gray-700">
                            <li><span class="badge badge-fix">FIX</span> <strong>Mobile Header:</strong> Memperbaiki bug tombol "Aset" yang hilang pada tampilan smartphone. Layout header kini responsif penuh.</li>
                            <li><span class="badge badge-ui">UI/UX</span> <strong>Strategic Tips Placement:</strong> Memindahkan kotak "Tips Pro" ke dalam jendela terminal agar instruksi krusial pasti terbaca.</li>
                            <li><span class="badge badge-docs">DOCS</span> <strong>Direct Hyperlink:</strong> Nama file aset pada panduan kini dapat diklik untuk download langsung.</li>
                            <li><span class="badge badge-ui">UI/UX</span> <strong>Mobile Typography:</strong> Penyesuaian ukuran font dan padding agar lebih nyaman dibaca di layar kecil.</li>
                        </ul>
                    </div>

                    <!-- v5.8 -->
                    <div class="mb-8 border-l-4 border-gray-200 pl-4 relative opacity-75 hover:opacity-100 transition-opacity">
                        <div class="absolute -left-[21px] top-0 w-3 h-3 rounded-full bg-gray-300 ring-4 ring-white"></div>
                        <h4 class="font-bold text-base text-gray-600">v5.8 (Final Release)</h4>
                        <p class="text-xs text-gray-400 mb-2">Rilis resmi dengan integrasi multimedia dan atribusi lengkap.</p>
                        <ul class="space-y-1.5 text-xs text-gray-500">
                            <li><span class="badge badge-docs">DOCS</span> Multimedia Integration: Tutorial Youtube dan Galeri.</li>
                            <li><span class="badge badge-docs">DOCS</span> Refined Instructions: Memperjelas langkah upload di Gemini.</li>
                            <li><span class="badge badge-new">UPDATE</span> Footer: Atribusi Tim Kerja Kehumasan & Developer.</li>
                        </ul>
                    </div>

                    <!-- v5.7 -->
                    <div class="mb-8 border-l-4 border-gray-200 pl-4 relative opacity-60 hover:opacity-100 transition-opacity">
                        <div class="absolute -left-[21px] top-0 w-3 h-3 rounded-full bg-gray-300 ring-4 ring-white"></div>
                        <h4 class="font-bold text-sm text-gray-600">v5.7 (Final Audit & Safety)</h4>
                         <ul class="space-y-1 text-xs text-gray-500 mt-2">
                            <li><span class="badge badge-ui">UI/UX</span> Terminal Look: Output JSON bergaya Code Editor.</li>
                            <li><span class="badge badge-safety">SAFETY</span> Warning Label: Label "Wajib Upload" pada HP SE2026.</li>
                        </ul>
                    </div>

                    <!-- v5.6 -->
                    <div class="mb-8 border-l-4 border-gray-200 pl-4 relative opacity-60 hover:opacity-100 transition-opacity">
                        <div class="absolute -left-[21px] top-0 w-3 h-3 rounded-full bg-gray-300 ring-4 ring-white"></div>
                        <h4 class="font-bold text-sm text-gray-600">v5.6 (Exotic Edition)</h4>
                        <ul class="space-y-1 text-xs text-gray-500 mt-2">
                            <li><span class="badge badge-logic">LOGIC</span> SARA Safe Label: "Coklat Eksotis" (Warm Umber).</li>
                            <li><span class="badge badge-ui">UI/UX</span> Visual Overhaul: Rounded UI & Soft Shadows.</li>
                        </ul>
                    </div>

                    <!-- Older Versions Collapsed -->
                    <div class="text-center">
                        <span class="text-xs text-gray-400 font-mono">... v5.5, v5.4, v5.3, v5.2, v5.1, v5.0, v4.1, v4.0, v3.x ...</span>
                    </div>

                </div>
                <div class="bg-gray-100 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse border-t border-gray-200">
                    <button type="button" class="w-full inline-flex justify-center rounded-xl border border-transparent shadow-sm px-5 py-2 bg-[#f79039] text-sm font-bold text-white hover:bg-[#ea580c] focus:outline-none sm:w-auto transition-all" onclick="toggleVersionModal()">
                        Tutup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-[#231f20] text-white text-center py-8 mt-auto border-t border-gray-800">
        <p class="font-bold text-sm tracking-wide">Tim Pelaksana SE 2026 - Tim Kerja Kehumasan dan Protokoler</p>
        <p class="text-xs mt-2 text-gray-500">BPS Provinsi Papua ¬©2026 <br> Developer : @faldodaffa</p>
        <!-- Added Version History Button -->
        <button onclick="toggleVersionModal()" class="mt-4 text-[10px] text-gray-600 hover:text-[#f79039] transition-colors border border-gray-700 hover:border-[#f79039] px-3 py-1 rounded-full">
            <i class="fas fa-code-branch mr-1"></i> v5.9 (History)
        </button>
    </footer>

    <script>
        // --- CONFIGURATION (Separated for Maintainability) ---
        const CONFIG = {
            assets: {
                character: [
                    { name: "bungitung.png (Original)", icon: "fas fa-user-tie", url: "https://drive.google.com/file/d/1LTIJKv5JVzy2mKmOk0lDocJ7uuBEtlVc/view?usp=drive_link" },
                    { name: "hpse2026.png (HP Logo)", icon: "fas fa-mobile", url: "https://drive.google.com/file/d/1RkeIIOjUCuea57enOZf6wrvdpDhAB2Eh/view?usp=drive_link" },
                    { name: "topise2026.png (Topi SE)", icon: "fas fa-hat-cowboy", url: "https://drive.google.com/file/d/1-RDcopPf85uUsPK4OkczpbnH4fDGm28e/view?usp=drive_link" }
                ],
                logo: [
                    { name: "Logo Vertikal", icon: "fas fa-image", url: "https://drive.google.com/file/d/1w3mQmBImsMMM3QsYEvrn5zD1Me1UNkyu/view?usp=drive_link" },
                    { name: "Logo Horizontal", icon: "fas fa-image", url: "https://drive.google.com/file/d/1UC5VU4tCz4D35wiOWTZBYLFnc5ReYWGP/view?usp=drive_link" },
                    { name: "Logo Tanpa Teks", icon: "fas fa-image", url: "https://drive.google.com/file/d/1CfmgL2gnwJ-rjw5BUo0YEU01nur-WT4v/view?usp=drive_link" }
                ]
            }
        };

        // --- DATA LOGIC ---
        const kbliData = {
            "NONE": { label: "Tanpa Konteks Sektor", headgear_context: "None", attire_context: "Standard Bung Itung Vest", held_items: "", ground_items: "", bg: "Clean studio background, neutral color" },
            "A": { label: "Pertanian, Kehutanan, dan Perikanan", headgear_context: "Traditional bamboo farmer hat (caping)", attire_context: "Farmer outfit with rolled-up sleeves", held_items: "holding a rice sickle", ground_items: "basket of vegetables, rice plants", bg: "rice field landscape, lush green forest, fishing boat at sea, plantation area" },
            "B": { label: "Pertambangan", headgear_context: "Yellow safety construction helmet", attire_context: "Mining worker outfit with high-vis vest", held_items: "holding a geological hammer", ground_items: "piles of rocks, pickaxe, blueprints", bg: "open pit mine, quarry site with excavators in distance, oil rig in background" },
            "C": { label: "Industri Pengolahan", headgear_context: "Factory safety cap", attire_context: "Factory worker jumpsuit or apron", held_items: "holding a wrench", ground_items: "manufactured products, tool box", bg: "factory interior with blurred machinery, assembly line background, industrial warehouse" },
            "D": { label: "Listrik, Gas, Uap", headgear_context: "Safety helmet with ear protection", attire_context: "Technician uniform with safety gloves", held_items: "holding an electrical meter or tablet displaying energy charts", ground_items: "insulated tools, cables", bg: "power plant facility, solar panel field, electrical substation towers in distance" },
            "E": { label: "Air & Limbah", headgear_context: "Safety cap", attire_context: "Sanitation worker uniform (blue accents)", held_items: "holding water pipe tools or water quality tester", ground_items: "recycling bin, pipes", bg: "water treatment plant, recycling facility, clean water reservoir" },
            "F": { label: "Konstruksi", headgear_context: "Yellow safety helmet", attire_context: "Construction worker outfit with utility belt", held_items: "holding rolled architectural blueprints", ground_items: "measuring tape, bricklayer trowel, level", bg: "building construction site with cranes, unfinished building structure, road construction" },
            "G": { label: "Perdagangan", headgear_context: "None", attire_context: "Shop assistant apron", held_items: "holding a point-of-sale scanner or calculator", ground_items: "shopping bags, product boxes", bg: "supermarket shelves, traditional market stalls, retail shop interior" },
            "H": { label: "Pengangkutan", headgear_context: "Delivery cap", attire_context: "Courier uniform", held_items: "holding a cardboard package or delivery scanner", ground_items: "hand truck, stack of boxes", bg: "logistics warehouse with boxes, shipping container yard, delivery truck in background" },
            "I": { label: "Akomodasi & Makan", headgear_context: "Chef hat", attire_context: "Chef apron or waiter uniform", held_items: "holding a serving tray with food or coffee cup", ground_items: "menu board, kitchen utensils", bg: "restaurant interior, hotel lobby, cafe setting, kitchen background" },
            "J": { label: "Info & Komunikasi", headgear_context: "Headphones (around neck)", attire_context: "Smart casual tech hoodie", held_items: "holding a laptop with stickers", ground_items: "server cables, smartphone with code on screen", bg: "modern tech office, server room with blinking lights, broadcasting studio" },
            "K": { label: "Keuangan", headgear_context: "None", attire_context: "Formal business suit", held_items: "holding a tablet with financial graphs", ground_items: "briefcase, calculator, coins", bg: "bank lobby, office with financial charts on glass walls, stock market screen" },
            "L": { label: "Real Estat", headgear_context: "None", attire_context: "Real estate agent blazer", held_items: "holding a house model key or property brochures", ground_items: "building model, contract papers", bg: "residential housing complex, apartment building exterior, modern office building" },
            "M": { label: "Profesional", headgear_context: "None", attire_context: "Lab coat or architect shirt", held_items: "holding scientific glassware/beaker or architect ruler", ground_items: "microscope, legal documents, magnifying glass", bg: "science laboratory, architect studio with drafting table, law library" },
            "N": { label: "Penyewaan", headgear_context: "None", attire_context: "Service uniform", held_items: "holding rental contract keys", ground_items: "travel brochures, gardening tools (services)", bg: "car rental lot, travel agency office, employment agency reception" },
            "O": { label: "Pemerintahan", headgear_context: "Peci", attire_context: "Civil servant uniform (KORPRI/Khaki)", held_items: "holding official documents", ground_items: "file folders, flag", bg: "government office building, city hall, flag pole area" },
            "P": { label: "Pendidikan", headgear_context: "None", attire_context: "Teacher attire (Batik)", held_items: "holding a textbook or pointer stick", ground_items: "whiteboard marker, graduation cap, books", bg: "classroom with desks, library shelves, university campus" },
            "Q": { label: "Kesehatan", headgear_context: "Surgical cap (optional)", attire_context: "Doctor coat or scrubs", held_items: "holding a clipboard or stethoscope", ground_items: "medical kit, thermometer", bg: "hospital corridor, doctor's examination room, pharmacy shelves" },
            "R": { label: "Kesenian", headgear_context: "Beret", attire_context: "Creative artsy outfit", held_items: "holding a paintbrush or musical instrument", ground_items: "camera, palette, art supplies", bg: "art gallery, theater stage, museum exhibition, stadium stands" },
            "S": { label: "Jasa Lainnya", headgear_context: "None", attire_context: "Service apron or uniform", held_items: "holding salon scissors/comb or repair tools", ground_items: "laundry basket, grooming kit", bg: "barbershop/salon interior, repair shop, laundry room, community center" },
            "T": { label: "Rumah Tangga", headgear_context: "None", attire_context: "Casual home outfit with apron", held_items: "holding cleaning tools or cooking utensils", ground_items: "gardening equipment, iron", bg: "home kitchen, living room, home garden" },
            "U": { label: "Badan Internasional", headgear_context: "None", attire_context: "Diplomatic suit", held_items: "holding international ID badge or briefcase", ground_items: "globe, documents", bg: "conference hall with international flags, diplomatic office" },
            "STAKEHOLDER": { label: "Stakeholder / Pejabat", headgear_context: "None", attire_context: "Formal Batik shirt", held_items: "holding a plaque or certificate", ground_items: "microphone stand", bg: "formal meeting room, podium with microphone, office backdrop" }
        };

        // --- UI FUNCTIONS ---
        function selectFormat(fmt) {
            document.getElementById('formatValue').value = fmt;
            document.getElementById('fmt-single').classList.remove('selected');
            document.getElementById('fmt-multipose').classList.remove('selected');
            document.getElementById('fmt-' + fmt).classList.add('selected');
            
            const poseSection = document.getElementById('poseSection');
            if (fmt === 'multipose') poseSection.classList.add('opacity-50', 'pointer-events-none');
            else poseSection.classList.remove('opacity-50', 'pointer-events-none');
        }

        function selectGender(gender) {
            document.getElementById('genderValue').value = gender;
            const buttons = document.querySelectorAll('.gender-btn');
            buttons.forEach(btn => btn.classList.remove('selected', 'bg-[#f79039]', 'border-[#f79039]', 'text-white', 'font-semibold'));
            buttons.forEach(btn => btn.classList.add('bg-white', 'text-gray-600'));
            
            const selectedBtn = document.getElementById('btn-' + gender);
            selectedBtn.classList.add('selected', 'bg-[#f79039]', 'border-[#f79039]', 'text-white', 'font-semibold');
            selectedBtn.classList.remove('bg-white', 'text-gray-600');
        }

        function selectPose(pose) {
            document.getElementById('poseValue').value = pose;
            document.querySelectorAll('#poseSection .option-card').forEach(el => el.classList.remove('selected'));
            document.getElementById('pose-' + pose).classList.add('selected');
        }

        function selectExpression(expr) {
            document.getElementById('expressionValue').value = expr;
            document.querySelectorAll('#expressionSection .option-card').forEach(el => el.classList.remove('selected'));
            document.getElementById('expr-' + expr).classList.add('selected');
        }

        function toggleCustomInput(type, show) {
            if (type === 'headgear') {
                const el = document.getElementById('customHeadgearText');
                if (show) el.classList.remove('hidden'); else el.classList.add('hidden');
            } else if (type === 'accessory') {
                const el = document.getElementById('customAccessoryText');
                if (show) el.classList.remove('hidden'); else el.classList.add('hidden');
            } else if (type === 'attire') {
                const el = document.getElementById('customAttireText');
                if (show) el.classList.remove('hidden'); else el.classList.add('hidden');
            }
        }

        // Render Asset List from Config
        function renderAssets() {
            const container = document.getElementById('assetsContainer');
            let html = `<div class="mb-4">
                        <p class="text-xs font-bold text-gray-400 uppercase tracking-wide mb-2">Karakter & Atribut</p>
                        <div class="space-y-2">`;
            
            CONFIG.assets.character.forEach(item => {
                html += `<a href="${item.url}" target="_blank" class="flex items-center p-3 bg-white rounded-lg border border-gray-100 hover:border-[#f79039] hover:shadow-md transition-all group">
                            <div class="w-8 h-8 rounded-full bg-orange-50 flex items-center justify-center mr-3 text-[#f79039] group-hover:bg-[#f79039] group-hover:text-white transition-colors"><i class="${item.icon}"></i></div>
                            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900">${item.name}</span>
                            <i class="fas fa-external-link-alt ml-auto text-xs text-gray-300 group-hover:text-[#f79039]"></i>
                        </a>`;
            });

            html += `</div></div><div>
                     <p class="text-xs font-bold text-gray-400 uppercase tracking-wide mb-2">Logo Resmi</p>
                     <div class="space-y-2">`;
            
            CONFIG.assets.logo.forEach(item => {
                 html += `<a href="${item.url}" target="_blank" class="flex items-center p-3 bg-white rounded-lg border border-gray-100 hover:border-[#f79039] hover:shadow-md transition-all group">
                            <div class="w-8 h-8 rounded-full bg-orange-50 flex items-center justify-center mr-3 text-[#f79039] group-hover:bg-[#f79039] group-hover:text-white transition-colors"><i class="${item.icon}"></i></div>
                            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900">${item.name}</span>
                            <i class="fas fa-external-link-alt ml-auto text-xs text-gray-300 group-hover:text-[#f79039]"></i>
                        </a>`;
            });
            html += `</div></div>`;
            container.innerHTML = html;
        }

        // Modal Function
        function toggleAssetModal() {
            const modal = document.getElementById('assetModal');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
            } else {
                modal.classList.add('hidden');
            }
        }

        // Version Modal Function
        function toggleVersionModal() {
            const modal = document.getElementById('versionModal');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
            } else {
                modal.classList.add('hidden');
            }
        }

        // GENERATE FUNCTION
        function generatePrompt() {
            try {
                // 1. Gather Inputs
                const format = document.getElementById('formatValue').value;
                const gender = document.getElementById('genderValue').value;
                const skinTone = document.getElementById('skinToneSelect').value;
                const expression = document.getElementById('expressionValue').value;
                const headgearSelection = document.querySelector('input[name="headgear"]:checked').value;
                const sectorCode = document.getElementById('sectorSelect').value;
                const attireMode = document.querySelector('input[name="attire"]:checked').value;
                const bgMode = document.querySelector('input[name="bg_mode"]:checked').value;
                let pose = document.getElementById('poseValue').value;

                // Collect Body/Hand Checkboxes & Custom
                let accessoriesList = [];
                let customAccessoryText = "";
                
                // Custom Accessory Logic (Now part of handheld items)
                let handhelds = [];
                const kbliInfo = kbliData[sectorCode];
                if (!kbliInfo) { alert("Error: Kode sektor tidak ditemukan."); return; }
                if (sectorCode !== 'NONE' && kbliInfo.held_items) handhelds.push(kbliInfo.held_items);

                if(document.getElementById('acc_custom').checked) {
                    customAccessoryText = document.getElementById('customAccessoryText').value || "Custom Accessory";
                    handhelds.push(`holding ${customAccessoryText}`); // Add to handhelds with "holding" prefix
                }

                if(document.getElementById('acc_noken').checked) {
                    let nokenDetail = "Wearing a rustic, handmade Noken-style shoulder bag made from pliable, non-rigid natural beige bark fibers. The bag is unstructured and hangs limply slung over shoulder, its soft form entirely shaped by a small brown kraft paper notebook and a sleek black smartphone visible through the open-loop mesh.";
                    accessoriesList.push(nokenDetail);
                }

                if(document.getElementById('acc_hpse').checked) accessoriesList.push("Smartphone displaying 'Sensus Ekonomi 2026' logo");
                if(document.getElementById('acc_glasses').checked) accessoriesList.push("Eyeglasses");
                
                // 2. Build Descriptions
                let charName = (gender === 'male') ? "Bung Itung" : "Mbak Sasa";
                let baseFacialFeatures = "distinctive large round bulbous nose, cartoonish head-to-body ratio"; 
                
                // Expression Logic (Updated)
                const expressionMap = {
                    'happy': "Wide friendly smile, eyebrows raised slightly, eyes squinted in curve (happy)",
                    'laugh': "Laughing out loud, eyes closed or squinted, open mouth smile, joyful expression",
                    'sad': "Mouth curved downwards, eyebrows tilted inwards and upwards, teary or closed eyes (sad/disappointed)",
                    'shock': "Jaw dropped open, eyes wide open, eyebrows raised high (shocked)",
                    'surprised': "Mouth slightly open, eyes widened, eyebrows raised (mildly surprised)",
                    'fear': "Eyes wide open with small pupils, eyebrows raised high, mouth gaping open (fearful)",
                    'shy': "Blush marks on cheeks, avoiding eye contact, shy smile (shy/bashful)",
                    'thinking': "Hand on chin, looking upwards or sideways, thoughtful expression"
                };
                let expressionDesc = expressionMap[expression] || expressionMap['happy'];
                let facialFeatures = `${baseFacialFeatures}. Expression: ${expressionDesc}`;

                // --- LOGIC: SKIN TONE (Warm Umber) ---
                let skinInstruction = "";
                let ethnicityDesc = "";
                let recommendedImageWeight = "HIGH (1.0 - 1.2)";

                if (skinTone === 'dark') {
                    // Refined Papuan/Warm Umber Logic (Internal)
                    ethnicityDesc = "Indigenous Papuan ethnicity, rich warm umber skin tone (Hex #5D4037) covering FACE, NECK, ARMS, and HANDS. Warm brown undertones.";
                    skinInstruction = "ENSURE SKIN COLOR IS WARM BROWN, NOT PITCH BLACK. Natural lighting on skin.";
                    recommendedImageWeight = "MEDIUM (0.7 - 0.8) - Important for skin color adaptation";
                } else if (skinTone === 'tan') {
                     ethnicityDesc = "Tan (Sawo Matang) Indonesian skin tone.";
                } else {
                     ethnicityDesc = "Fair/Light (Kuning Langsat) skin tone.";
                }

                // Headgear Description Logic
                let headgearDesc = "None";
                let customHeadgearText = "";
                
                if (headgearSelection === 'custom_headgear') {
                    customHeadgearText = document.getElementById('customHeadgearText').value || "Custom Traditional Hat";
                    headgearDesc = `Wearing ${customHeadgearText}`;
                } else if (headgearSelection === 'topi_se2026') {
                    headgearDesc = "Wearing Black cap with orange visor and 'Sensus Ekonomi 2026' logo";
                } else if (headgearSelection === 'mahkota_papua') {
                    headgearDesc = "Wearing detailed traditional Papuan headdress. Upper section: Stiff, coarse dark brown fibers radiating upwards (cassowary feathers). Lower section: Woven headband decorated with off-white cowrie shells in floral patterns, bright red beads, and vibrant yellow piping.";
                } else if (headgearSelection === 'contextual') {
                    if (kbliInfo.headgear_context !== "None") headgearDesc = "Wearing " + kbliInfo.headgear_context;
                } else if (headgearSelection === 'helm_proyek') {
                     headgearDesc = "Wearing Yellow safety construction helmet";
                } else if (headgearSelection === 'caping') {
                     headgearDesc = "Wearing Traditional bamboo farmer hat (caping)";
                }

                // Hair & Hijab Logic
                let additionalNegativePrompts = "";
                let headgearActive = (headgearDesc !== "None");

                if (gender === 'female_hijab') {
                    additionalNegativePrompts += ", visible hair, hair roots, hair texture";
                    genderDesc = `Female version of Bung Itung (Hijab). Wearing yellow hijab tucked in. **Note: ${headgearActive ? headgearDesc + ' is worn ON TOP of the hijab.' : ''} ABSOLUTELY NO HAIR VISIBLE.** Facial features: ${facialFeatures}.`;
                     if (skinTone === 'dark') ethnicityDesc = "Indigenous Papuan ethnicity, rich warm umber skin tone (Hex #5D4037) covering FACE and HANDS (Body covered).";
                } else {
                    let hairDescription = "short neat black hair."; 
                    if (gender !== 'male') hairDescription = "Hair: Ponytail."; 

                    // LOGIC: If Dark Skin AND No Headgear, Force Curly Hair
                    if (skinTone === 'dark') {
                        if (!headgearActive) {
                            hairDescription = (gender === 'male') ? "short curly black hair." : "Hair: Curly Ponytail.";
                        } else {
                            // If hat is worn, hair might be tucked
                            hairDescription = (gender === 'male') ? "short curly black hair." : "Hair: Curly Ponytail.";
                        }
                    }

                    if (headgearActive) {
                         hairDescription = `Neat hair tucked under the ${headgearDesc}.`;
                         if (skinTone === 'dark') hairDescription = `Curly hair mostly tucked under the ${headgearDesc}.`;
                    }
                    genderDesc = `Female. Facial features: ${facialFeatures}. ${hairDescription}`;
                }

                // Attire Description & Modesty Logic
                let attireDesc = "";
                let customAttireText = "";

                // COLOR CORRECTION FOR ATTIRE
                let uniformDesc = "Official census uniform: Black vest with Jingga Nadi Orange (#f79039) accents, yellow collared shirt underneath, ID Card lanyard.";

                if (attireMode === 'custom_attire') {
                    customAttireText = document.getElementById('customAttireText').value || "Custom Traditional Attire";
                    attireDesc = `Wearing ${customAttireText}.`;
                } else if (attireMode === 'original' || sectorCode === 'NONE') {
                    attireDesc = `Wearing ${uniformDesc}`;
                } else {
                    attireDesc = `Wearing ${kbliInfo.attire_context}.`;
                }

                // Inject Modesty Logic for Hijab
                if (gender === 'female_hijab') {
                    attireDesc += " (Modest, long-sleeved top and full-length bottom ensuring full coverage)";
                }

                // Pose Description
                let poseDesc = "Standing naturally";
                if (pose === 'random') {
                    const randomPoses = [
                        "Presenting gesture with open arms, welcoming",
                        "Standing confidently at camera",
                        "Walking forward with purpose",
                        "Standing with hands on hips",
                        "Giving a thumbs up with one hand"
                    ];
                    poseDesc = randomPoses[Math.floor(Math.random() * randomPoses.length)];
                } else if (format === 'single') {
                    const poseMap = {
                         'thumbs_up': "Giving a thumbs up",
                         'pointing': "Pointing finger to the side (empty space for text)",
                         'waving': "Waving hand in a friendly greeting gesture",
                         'open_palms': "Presenting gesture with open palms facing slightly upwards",
                         'hand_on_chest': "One hand placed respectfully on the chest over the heart, service gesture",
                         'thank_you': "Hands clasped together in a gesture of gratitude or slight bow saying thank you",
                         'ready': "Standing tall with hands on hips or crossed, ready for action (sigap)",
                         'salute': "Casual salute gesture to a friend, hand near forehead"
                     };
                     poseDesc = poseMap[pose] || "Standing";
                } else {
                    // Updated Multipose Logic
                    poseDesc = `Character Reference Sheet. 4 distinct, dynamic full-body action poses arranged in a 2x2 grid. All poses show the character with a ${expression} expression. No static side views. Consistent character design across all views. White background.`;
                }

                // Env & Props
                let envDesc = "";
                let itemsGround = (sectorCode === 'NONE' || format === 'multipose') ? "No ground props, clean floor." : `Props on ground/nearby: ${kbliInfo.ground_items}.`;
                envDesc = (sectorCode === 'NONE' || format === 'multipose' || bgMode === 'prop_focus') ? 
                    "Clean, plain white/light studio background." : 
                    `${kbliInfo.bg}. Background is blurred (depth of field).`;

                // Handheld Smartphone Logic
                if (accessoriesList.some(acc => acc.includes("Smartphone"))) {
                     handhelds.push("holding Smartphone displaying 'Sensus Ekonomi 2026' logo");
                }
                
                let itemsHeld = handhelds.join(", ");
                let wearablesStr = accessoriesList.filter(a => !a.includes("Smartphone")).join(", ");
                let papuaForce = (skinTone === 'dark') ? "RICH WARM BROWN SKIN. " : "";

                const fullPrompt = `(Image Reference Style). 3D Render. Pixar Disney Style. CHARACTER: ${charName} (${genderDesc}). **CRITICAL: KEEP FACIAL SHAPE IDENTICAL TO REFERENCE.** **HUMAN ANATOMY: ONLY TWO ARMS, TWO HANDS** ${ethnicityDesc} ${skinInstruction} ${papuaForce} \n\nWEARABLES: ${headgearDesc}. ${attireDesc} ${wearablesStr}. \n\nACTION: ${poseDesc}. ${itemsHeld}. \n\nENV: ${envDesc} ${itemsGround}.`;

                // JSON Object
                const promptData = {
                    "meta": {
                        "project": "SE2026 Nusantara",
                        "version": "5.8 (Final Release)"
                    },
                    "generation_settings": {
                        "aspect_ratio": format === 'single' ? "2:3 (Portrait)" : "1:1 (Square)",
                        "image_weight": recommendedImageWeight
                    },
                    "image_references": {
                        "main_character": "Upload 'bungitung.png'",
                        "custom_uploads": []
                    },
                    "final_positive_prompt": fullPrompt,
                    "negative_prompt": "photorealistic, real human, pitch black skin, grey skin, ugly, distorted, bad anatomy, yellow color (avoid yellow, use orange), extra limbs, extra arms, three arms, four arms, extra legs, extra hands, mutated hands, " + additionalNegativePrompts
                };

                // Dynamic Upload Instructions
                if (headgearSelection === 'topi_se2026') promptData.image_references.custom_uploads.push("Upload 'topise2026.png'");
                if (headgearSelection === 'custom_headgear') promptData.image_references.custom_uploads.push(`Upload Reference Image for: '${customHeadgearText}'`);
                if (attireMode === 'custom_attire') promptData.image_references.custom_uploads.push(`Upload Reference Image for: '${customAttireText}'`);
                if (document.getElementById('acc_custom').checked) promptData.image_references.custom_uploads.push(`Upload Reference Image for: '${customAccessoryText}'`);
                if (document.getElementById('acc_hpse').checked) promptData.image_references.custom_uploads.push("Upload 'hpse2026.png'");

                document.getElementById('jsonOutput').innerHTML = syntaxHighlight(JSON.stringify(promptData, null, 2));

            } catch (e) {
                alert("Error: " + e.message);
            }
        }

        // Helper: JSON Syntax Highlighting
        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                var cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) { cls = 'json-key'; } else { cls = 'json-string'; }
                } else if (/true|false/.test(match)) { cls = 'json-boolean'; } else if (/null/.test(match)) { cls = 'json-boolean'; }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }

        // --- UPDATE: MODERN CLIPBOARD API ---
        async function copyToClipboard() {
            const text = document.getElementById('jsonOutput').textContent;
            
            // Modern API (Secure Context)
            if (navigator.clipboard && window.isSecureContext) {
                try {
                    await navigator.clipboard.writeText(text);
                    alert("Prompt JSON berhasil disalin!");
                    return;
                } catch (err) {
                    console.warn("Clipboard API failed, falling back to legacy", err);
                }
            }

            // Fallback (Legacy)
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try { 
                document.execCommand('copy'); 
                alert("Prompt JSON berhasil dicopy! (Legacy Mode)"); 
            } catch (err) { 
                alert("Gagal copy manual."); 
            }
            document.body.removeChild(textArea);
        }

        function updateBgDesc() {}
        
        document.addEventListener('DOMContentLoaded', () => {
             renderAssets(); // Load dynamic assets
        });
    </script>
</body>
</html>
